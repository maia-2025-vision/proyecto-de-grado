schema: '2.0'
stages:
  patches-512-ol-160-mv01-val:
    cmd: python oficial_herdnet/tools/patcher.py data/val 512 512 160 
      data/patches-512-ol-160-m01/val  -csv 
      data/groundtruth/csv/val_big_size_A_B_E_K_WH_WB-fixed-header.csv && python
      oficial_herdnet/tools/csv_to_points.py -i 
      data/patches-512-ol-160-m01/val/gt.csv -o 
      data/patches-512-ol-160-m01/val_points_gt.csv
    deps:
    - path: data/groundtruth/csv/val_big_size_A_B_E_K_WH_WB-fixed-header.csv
      hash: md5
      md5: 15acbab82e8022090098948c43ebff89
      size: 50622
    - path: data/val/
      hash: md5
      md5: 7c59a6075823e53aceb6ed1985746da5.dir
      size: 1041037675
      nfiles: 111
    - path: oficial_herdnet/tools/patcher.py
      hash: md5
      md5: d2a425277992cba02663f97de6ff6fdb
      size: 3940
    outs:
    - path: data/patches-512-ol-160-m01/val/
      hash: md5
      md5: 66d0c949e34d595a2da73c7a1cd5b190.dir
      size: 42355412
      nfiles: 1167
    - path: data/patches-512-ol-160-m01/val_points_gt.csv
      hash: md5
      md5: 5c329172fbad52ddd362b5e67bccf651
      size: 95080
  patches-512-ol-160-mv01-test:
    cmd: python oficial_herdnet/tools/patcher.py data/test 512 512 160 
      data/patches-512-ol-160-m01/test  -csv 
      data/groundtruth/csv/test_big_size_A_B_E_K_WH_WB-fixed-header.csv && 
      python oficial_herdnet/tools/csv_to_points.py -i 
      data/patches-512-ol-160-m01/test/gt.csv -o 
      data/patches-512-ol-160-m01/test_points_gt.csv
    deps:
    - path: data/groundtruth/csv/test_big_size_A_B_E_K_WH_WB-fixed-header.csv
      hash: md5
      md5: 30731a9a455b58e36394dd89e24849dc
      size: 120385
    - path: data/test/
      hash: md5
      md5: 543905ee38c7af30e4a5ccc4b1670752.dir
      size: 2117638463
      nfiles: 258
    - path: oficial_herdnet/tools/patcher.py
      hash: md5
      md5: c07f8d75238ff27ea1404b230d36bb88
      size: 4295
    outs:
    - path: data/patches-512-ol-160-m01/test/
      hash: md5
      md5: 71eb378f9db92d36b358703d400013cd.dir
      size: 75831301
      nfiles: 2559
    - path: data/patches-512-ol-160-m01/test_points_gt.csv
      hash: md5
      md5: d637312c2d5d6bd6acb1d05ac5560362
      size: 230725
  patches-512-ol-160-mv01-train:
    cmd: python oficial_herdnet/tools/patcher.py data/train 512 512 160 
      data/patches-512-ol-160-m01/train  -csv 
      data/groundtruth/csv/train_big_size_A_B_E_K_WH_WB-fixed-header.csv && 
      python oficial_herdnet/tools/csv_to_points.py -i 
      data/patches-512-ol-160-m01/train/gt.csv -o 
      data/patches-512-ol-160-m01/train_points_gt.csv
    deps:
    - path: data/groundtruth/csv/train_big_size_A_B_E_K_WH_WB-fixed-header.csv
      hash: md5
      md5: 4df85b8755658f264f15ab15aa3b7ef3
      size: 362524
    - path: data/train/
      hash: md5
      md5: cdd58c7737f0c1e8b7a4db5f99619b86.dir
      size: 8163547559
      nfiles: 928
    - path: oficial_herdnet/tools/patcher.py
      hash: md5
      md5: d2a425277992cba02663f97de6ff6fdb
      size: 3940
    outs:
    - path: data/patches-512-ol-160-m01/train/
      hash: md5
      md5: 8a7be22b432edc7050cc3cd719c278d3.dir
      size: 300527679
      nfiles: 8582
    - path: data/patches-512-ol-160-m01/train_points_gt.csv
      hash: md5
      md5: 4f162229d5e0c3bb1b92e44132e5e4a0
      size: 707567
  train-herdnet-v1:
    cmd: python oficial_herdnet/tools/train.py 
      train.training_settings.work_dir=data/models/herdnet_v1/
    deps:
    - path: data/patches-512-ol-160-m01/train/
      hash: md5
      md5: 8a7be22b432edc7050cc3cd719c278d3.dir
      size: 300527679
      nfiles: 8582
    - path: data/patches-512-ol-160-m01/train_points_gt.csv
      hash: md5
      md5: 4f162229d5e0c3bb1b92e44132e5e4a0
      size: 707567
    - path: data/patches-512-ol-160-m01/val/
      hash: md5
      md5: 66d0c949e34d595a2da73c7a1cd5b190.dir
      size: 42355412
      nfiles: 1167
    - path: data/patches-512-ol-160-m01/val_points_gt.csv
      hash: md5
      md5: 5c329172fbad52ddd362b5e67bccf651
      size: 95080
    outs:
    - path: data/models/herdnet_v1/
      hash: md5
      md5: 4cec24c59fd4329af6c3957a2489455b.dir
      size: 440615282
      nfiles: 4
  fix-headers-train-csv:
    cmd: "sed '1s/Image,x1,y1,x2,y2,Label/images,x_min,y_min,x_max,y_max,labels/'
      data/groundtruth/csv/train_big_size_A_B_E_K_WH_WB.csv > data/gt-preprocessed/csv/train_big_size_A_B_E_K_WH_WB-fixed-header.csv\n"
    deps:
    - path: data/groundtruth/csv/train_big_size_A_B_E_K_WH_WB.csv
      hash: md5
      md5: b9a83adcb4338121b4a29bb538223069
      size: 362510
    outs:
    - path: 
        data/gt-preprocessed/csv/train_big_size_A_B_E_K_WH_WB-fixed-header.csv
      hash: md5
      md5: 4df85b8755658f264f15ab15aa3b7ef3
      size: 362524
  fix-headers-val-csv:
    cmd: "sed '1s/Image,x1,y1,x2,y2,Label/images,x_min,y_min,x_max,y_max,labels/'
      data/groundtruth/csv/val_big_size_A_B_E_K_WH_WB.csv > data/gt-preprocessed/csv/val_big_size_A_B_E_K_WH_WB-fixed-header.csv\n"
    deps:
    - path: data/groundtruth/csv/val_big_size_A_B_E_K_WH_WB.csv
      hash: md5
      md5: 670bc1087d9255d49156e84fa95ef4d7
      size: 50608
    outs:
    - path: data/gt-preprocessed/csv/val_big_size_A_B_E_K_WH_WB-fixed-header.csv
      hash: md5
      md5: 15acbab82e8022090098948c43ebff89
      size: 50622
  fix-headers-test-csv:
    cmd: "sed '1s/Image,x1,y1,x2,y2,Label/images,x_min,y_min,x_max,y_max,labels/'
      data/groundtruth/csv/test_big_size_A_B_E_K_WH_WB.csv > data/gt-preprocessed/csv/test_big_size_A_B_E_K_WH_WB-fixed-header.csv\n"
    deps:
    - path: data/groundtruth/csv/test_big_size_A_B_E_K_WH_WB.csv
      hash: md5
      md5: f9f826c539574dbd80c8a8e70ff9e2cf
      size: 120371
    outs:
    - path: 
        data/gt-preprocessed/csv/test_big_size_A_B_E_K_WH_WB-fixed-header.csv
      hash: md5
      md5: 30731a9a455b58e36394dd89e24849dc
      size: 120385
  patches-512-ol-160-mv0.3-val:
    cmd: "python ../HerdNet/tools/patcher.py    -csv data/groundtruth/csv/val_big_size_A_B_E_K_WH_WB-fixed-header.csv\
      \  -min 0.3       data/val/  512 512 160  data/patches-512-ol-160-m0.3/val\n"
    deps:
    - path: ../HerdNet/tools/patcher.py
      hash: md5
      md5: 2a07254dd36f2589e746b047d9ed640d
      size: 3802
    - path: data/groundtruth/csv/val_big_size_A_B_E_K_WH_WB-fixed-header.csv
      hash: md5
      md5: 15acbab82e8022090098948c43ebff89
      size: 50622
    - path: data/val/
      hash: md5
      md5: 7c59a6075823e53aceb6ed1985746da5.dir
      size: 1041037675
      nfiles: 111
    outs:
    - path: data/patches-512-ol-160-m0.3/val
      hash: md5
      md5: f2004882a9587bdc5af0fc4a4b1ab98d.dir
      size: 40527016
      nfiles: 1114
  patches-512-ol-160-mv0.3-test:
    cmd: "python ../HerdNet/tools/patcher.py    -csv data/groundtruth/csv/test_big_size_A_B_E_K_WH_WB-fixed-header.csv\
      \  -min 0.3 data/test/  512 512 160  data/patches-512-ol-160-m0.3/test\n"
    deps:
    - path: ../HerdNet/tools/patcher.py
      hash: md5
      md5: 2a07254dd36f2589e746b047d9ed640d
      size: 3802
    - path: data/groundtruth/csv/test_big_size_A_B_E_K_WH_WB-fixed-header.csv
      hash: md5
      md5: 30731a9a455b58e36394dd89e24849dc
      size: 120385
    - path: data/test/
      hash: md5
      md5: 543905ee38c7af30e4a5ccc4b1670752.dir
      size: 2117638463
      nfiles: 258
    outs:
    - path: data/patches-512-ol-160-m0.3/test/
      hash: md5
      md5: 5b82623f43769c275ad2d246baa5ecb3.dir
      size: 72509931
      nfiles: 2445
  patches-512-ol-160-mv0.3-train:
    cmd: "python ../HerdNet/tools/patcher.py    -csv data/groundtruth/csv/train_big_size_A_B_E_K_WH_WB-fixed-header.csv\
      \  -min 0.3 data/train/  512 512 160  data/patches-512-ol-160-m0.3/train\n"
    deps:
    - path: ../HerdNet/tools/patcher.py
      hash: md5
      md5: 2a07254dd36f2589e746b047d9ed640d
      size: 3802
    - path: data/groundtruth/csv/train_big_size_A_B_E_K_WH_WB-fixed-header.csv
      hash: md5
      md5: 4df85b8755658f264f15ab15aa3b7ef3
      size: 362524
    - path: data/train/
      hash: md5
      md5: cdd58c7737f0c1e8b7a4db5f99619b86.dir
      size: 8163547559
      nfiles: 928
    outs:
    - path: data/patches-512-ol-160-m0.3/train
      hash: md5
      md5: 264c4092e03de15c3c67bc19e0793d4a.dir
      size: 285273691
      nfiles: 8142
  patches-512-ol-160-mv0.3-train-tiny:
    cmd: "mkdir -p data/patches-512-ol-160-m0.3/train-tiny && head -n 200 data/patches-512-ol-160-m0.3/train/gt.csv\
      \  > data/patches-512-ol-160-m0.3/train-tiny/gt-head-200.csv\n"
    deps:
    - path: data/patches-512-ol-160-m0.3/train/gt.csv
      hash: md5
      md5: ab0941404acb2006ee1e210438de8c4c
      size: 1212027
    outs:
    - path: data/patches-512-ol-160-m0.3/train-tiny/gt-head-200.csv
      hash: md5
      md5: f6be0c3a0883902dd377c80886f25be4
      size: 21984
  patches-512-ol-160-mv0.3-valid-tiny:
    cmd: "mkdir -p data/patches-512-ol-160-m0.3/val-tiny &&  head -n 25 data/patches-512-ol-160-m0.3/val/gt.csv\
      \  > data/patches-512-ol-160-m0.3/val-tiny/gt-head-25.csv\n"
    deps:
    - path: data/patches-512-ol-160-m0.3/val/gt.csv
      hash: md5
      md5: 1cc3e635f39f7c4e96d03896e1c8a34e
      size: 163824
    outs:
    - path: data/patches-512-ol-160-m0.3/val-tiny/gt-head-25.csv
      hash: md5
      md5: f4866b730e65a2f4791cc7deafd8f063
      size: 2708
  train-faster-rcnn-resnet-50-hn-trainer-tiny:
    cmd: "python oficial_herdnet/tools/train.py  --config-path $PWD/configs/ train=faster_rcnn_herdnet_trainer
      train.training_settings.work_dir=data/models/faster-rcnn-tiny train.training_settings.epochs=3
      train.datasets.train.csv_file=data/patches-512-ol-160-m0.3/train-tiny/gt-head-200.csv
      train.datasets.validate.csv_file=data/patches-512-ol-160-m0.3/val-tiny/gt-head-25.csv
      train.training_settings.print_freq=10\n"
    deps:
    - path: data/patches-512-ol-160-m0.3/train-tiny/gt-head-200.csv
      hash: md5
      md5: f6be0c3a0883902dd377c80886f25be4
      size: 21984
    - path: data/patches-512-ol-160-m0.3/val-tiny/gt-head-25.csv
      hash: md5
      md5: f4866b730e65a2f4791cc7deafd8f063
      size: 2708
    - path: oficial_herdnet/tools/train.py
      hash: md5
      md5: e2bfa812a8a05e5ac2f44125f26d90ec
      size: 13040
    outs:
    - path: data/models/faster-rcnn-tiny
      hash: md5
      md5: 35cc74c89fc3e1b9a4f3c9c718a2b1e3.dir
      size: 992863812
      nfiles: 4
  add-info-to-tmp-model:
    cmd: "python tools/add_info_to_model.py --config-path $PWD/configs/ train=faster_rcnn_herdnet_trainer\
      \         add_info.best_model_pth_path=data/models/tmp/faster-rcnn/best_model-by-epoch-70.pth\n"

  train-faster-rcnn-hn-trainer:
    cmd: "python oficial_herdnet/tools/train.py  --config-path $PWD/configs/ train=faster_rcnn_herdnet_trainer\
      \  train.training_settings.work_dir=data/models/faster-rcnn/resnet50-100-epochs-tbl4
      train.training_settings.epochs=100\n"
    deps:
    - path: configs/train/faster_rcnn_herdnet_trainer.yaml
      hash: md5
      md5: ff9f05a188d5325a613d5ee5769db05d
      size: 2265
    - path: data/patches-512-ol-160-m0.3/train/gt.csv
      hash: md5
      md5: ab0941404acb2006ee1e210438de8c4c
      size: 1212027
    - path: oficial_herdnet/tools/train.py
      hash: md5
      md5: e2bfa812a8a05e5ac2f44125f26d90ec
      size: 13040
    - path: data/test/
      hash: md5
      md5: 543905ee38c7af30e4a5ccc4b1670752.dir
      size: 2117638463
      nfiles: 258
    outs:
    - path: data/models/faster-rcnn/resnet50-100-epochs-tbl4
      hash: md5
      md5: d81b61b11fb66679e17cbea3d2b3325e.dir
      size: 1490431295
      nfiles: 5

  test-faster-rcnn-resnet50-patches:
    cmd: "python oficial_herdnet/tools/test.py  --config-path $PWD/configs/ test=faster_rcnn
      test.device_name=\"cuda\" test.wandb_mode=\"online\" test.wandb_run=test-frcnn-resnet50
      test.model.pth_file=data/models/faster-rcnn/resnet50-100-epochs-tbl4/best_model.pth
      test.model.kwargs.architecture=resnet50 test.stitcher=null test.dataset.csv_file=data/patches-512-ol-160-m0.3/test/gt.csv
      test.dataset.root_dir=data/patches-512-ol-160-m0.3/test/ test.results_dir=data/test_results/frcnn-resnet50\n"
    deps:
    - path: ./configs/test/faster_rcnn.yaml
      hash: md5
      md5: 2f8a1595e15f79ee52a6e081e33715bb
      size: 1231
    - path: data/models/faster-rcnn/resnet50-100-epochs-tbl4
      hash: md5
      md5: d81b61b11fb66679e17cbea3d2b3325e.dir
      size: 1490431295
      nfiles: 5
    - path: data/patches-512-ol-160-m0.3/test/
      hash: md5
      md5: 5b82623f43769c275ad2d246baa5ecb3.dir
      size: 72509931
      nfiles: 2445
    outs:
    - path: data/test_results/frcnn-resnet50
      hash: md5
      md5: f5c639b6ebd529040e88d2c26270cd3d.dir
      size: 1516718
      nfiles: 4

  test-faster-rcnn-resnet50-full:
    cmd: "python oficial_herdnet/tools/test.py  --config-path $PWD/configs/ test=faster_rcnn
      test.device_name=\"cuda\" test.wandb_mode=\"online\" test.dataset.batch_size=1
      test.wandb_run=test-frcnn-resnet50 test.model.pth_file=data/models/faster-rcnn/resnet50-100-epochs-tbl4/best_model.pth
      test.model.kwargs.architecture=resnet50 test.dataset.csv_file=data/gt-preprocessed/csv/test_big_size_A_B_E_K_WH_WB-fixed-header.csv
      test.dataset.root_dir=data/test/ test.results_dir=data/test_results/frcnn-resnet50-full-imgs\n"
    deps:
    - path: ./configs/test/faster_rcnn.yaml
      hash: md5
      md5: 2f8a1595e15f79ee52a6e081e33715bb
      size: 1231

    - path: data/models/faster-rcnn/resnet50-100-epochs-tbl4
      hash: md5
      md5: d81b61b11fb66679e17cbea3d2b3325e.dir
      size: 1490431295
      nfiles: 5
    outs:
    - path: data/test_results/frcnn-resnet50-full-imgs
      hash: md5
      md5: 67ba715b47bc3e01aad498392943b781.dir
      size: 1245499

  train-faster-rcnn-resnet-101:
    cmd: "python oficial_herdnet/tools/train.py  --config-path $PWD/configs/ train=faster_rcnn_herdnet_trainer
      train.wandb_mode=offline train.wandb_run=faster-rcnn-resnet-101 train.model.kwargs.architecture=resnet101
      train.training_settings.work_dir=data/models/faster-rcnn/resnet101-100-epochs-tbl4
      train.training_settings.epochs=100\n"
    deps:
    - path: configs/train/faster_rcnn_herdnet_trainer.yaml
      hash: md5
      md5: f3a7bc4136e6d2802009465b60fbe938
      size: 2299
    - path: data/patches-512-ol-160-m0.3/train/gt.csv
      hash: md5
      md5: ab0941404acb2006ee1e210438de8c4c
      size: 1212027
    - path: oficial_herdnet/tools/train.py
      hash: md5
      md5: 7078b8ab8748ae763c7967344fd9a9f2
      size: 14206
    outs:
    - path: data/models/faster-rcnn/resnet101-100-epochs-tbl4
      hash: md5
      md5: 320af9eda3b9c8e7e0914cfbc3ce817a.dir
      size: 1449564593

  test-faster-rcnn-resnet101-full:
    cmd: "python oficial_herdnet/tools/test.py  --config-path $PWD/configs/ test=faster_rcnn
      test.device_name=\"cuda\" test.wandb_mode=\"online\" test.dataset.batch_size=1
      test.wandb_run=test-frcnn-resnet101 test.model.pth_file=data/models/faster-rcnn/resnet101-100-epochs-tbl4/best_model.pth
      test.model.kwargs.architecture=resnet101 test.dataset.csv_file=data/gt-preprocessed/csv/test_big_size_A_B_E_K_WH_WB-fixed-header.csv
      test.dataset.root_dir=data/test/ test.results_dir=data/test_results/frcnn-resnet101-full-imgs\n"
    deps:
    - path: ./configs/test/faster_rcnn.yaml
      hash: md5
      md5: 2f8a1595e15f79ee52a6e081e33715bb
      size: 1231
    - path: data/models/faster-rcnn/resnet101-100-epochs-tbl4
      hash: md5
      md5: 320af9eda3b9c8e7e0914cfbc3ce817a.dir
      size: 1449564593
      nfiles: 4
    - path: data/test/
      hash: md5
      md5: 543905ee38c7af30e4a5ccc4b1670752.dir
      size: 2117638463
      nfiles: 258
    outs:
    - path: data/test_results/frcnn-resnet101-full-imgs
      hash: md5
      md5: ea48f6a005445c58f46ff4b0ab5e1bcb.dir
      size: 1120993
      nfiles: 4

  desc-faster-rcnn-resnet50:
    cmd: "python tools/describe_model.py --config-path=$PWD/configs  test=faster_rcnn
      test.device_name=\"cpu\" test.model.kwargs.architecture=resnet50 test.model.kwargs.trainable_backbone_layers=4
      test.model.pth_file=data/models/faster-rcnn/resnet50-100-epochs-tbl4/best_model.pth
      +test.group_depth=2 +test.results_file=data/model_descs/parameters-frcnn-resnet-50.csv\n"
    deps:
    - path: ./configs/test/faster_rcnn.yaml
      hash: md5
      md5: 200dc9587b7fc6c99328563464cebef5
      size: 1203
    - path: data/models/faster-rcnn/resnet50-100-epochs-tbl4
      hash: md5
      md5: d81b61b11fb66679e17cbea3d2b3325e.dir
      size: 1490431295
      nfiles: 5
    - path: tools/describe_model.py
      hash: md5
      md5: a77d72cf42f37765396a1590a123ca2f
      size: 1924
    outs:
    - path: data/model_descs/parameters-frcnn-resnet-50.csv
      hash: md5
      md5: d4804f6913553b04731e25ba51b3fd48
      size: 145

  desc-herdnet-v1:
    cmd: "python tools/describe_model.py --config-path=$PWD/configs  test=herdnet
      test.device_name=\"cpu\" test.model.pth_file=data/models/herdnet_v1/best_model.pth
      +test.group_depth=2 +test.results_file=data/model_descs/parameters-herdnet-v1.csv\n"
    deps:
    - path: data/models/herdnet_v1/best_model.pth
      hash: md5
      md5: 42e16db884bb86fed58d7b5e7dd60e01
      size: 219993031
    - path: oficial_herdnet/configs/test/herdnet.yaml
      hash: md5
      md5: e6865b870a7ed44d90ac202a8a937a94
      size: 868
    - path: tools/describe_model.py
      hash: md5
      md5: a77d72cf42f37765396a1590a123ca2f
      size: 1924
    outs:
    - path: data/model_descs/parameters-herdnet-v1.csv
      hash: md5
      md5: b500d8213f3144d096d7282eacd461b3
      size: 177

  test-herdnet-v1:
    cmd: "python oficial_herdnet/tools/test.py --config-path ../configs/ --config-name=\"\
      config\" test.results_dir=data/test_results/herdnet_v1/ test.stitcher=null\n"
    deps:
    - path: data/patches-512-ol-160-m01/test/
      hash: md5
      md5: 71eb378f9db92d36b358703d400013cd.dir
      size: 75831301
      nfiles: 2559
    - path: data/patches-512-ol-160-m01/test_points_gt.csv
      hash: md5
      md5: d637312c2d5d6bd6acb1d05ac5560362
      size: 230725
    outs:
    - path: data/test_results/herdnet_v1/
      hash: md5
      md5: 11d9a2d0f294b65055806808006a14e4.dir
      size: 805188
      nfiles: 4
  desc-faster-rcnn-resnet101:
    cmd: "python tools/describe_model.py --config-path=$PWD/configs test=faster_rcnn
      test.device_name=\"cpu\" test.model.kwargs.architecture=resnet101 test.model.kwargs.trainable_backbone_layers=4
      test.model.pth_file=data/models/faster-rcnn/resnet101-100-epochs-tbl4/best_model.pth
      +test.group_depth=2 +test.results_file=data/model_descs/parameters-frcnn-resnet-101.csv\n"
    deps:
    - path: ./configs/test/faster_rcnn.yaml
      hash: md5
      md5: 200dc9587b7fc6c99328563464cebef5
      size: 1203
    - path: data/models/faster-rcnn/resnet101-100-epochs-tbl4
      hash: md5
      md5: 320af9eda3b9c8e7e0914cfbc3ce817a.dir
      size: 1449564593
      nfiles: 4
    - path: tools/describe_model.py
      hash: md5
      md5: b46f0331b7ac4d1ea4d455e9bfe3027c
      size: 2001
    outs:
    - path: data/model_descs/parameters-frcnn-resnet-101.csv
      hash: md5
      md5: 41c0a7e0c0186f378264892bc0a81ac2
      size: 145
